

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>resistics.project.time &mdash; resistics 0.0.6 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html"> resistics
          

          
            
            <img src="../../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.0.6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search..." />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../formats.html">Data formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../advanced.html">Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cookbook.html">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../case-studies.html">Case studies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog / backlog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../credits.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../donate.html">Donate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contact.html">Contact</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">resistics</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">resistics</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>resistics.project.time</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for resistics.project.time</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="k">import</span> <span class="n">Figure</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">List</span>

<span class="kn">from</span> <span class="nn">resistics.project.data</span> <span class="k">import</span> <span class="n">ProjectData</span>
<span class="kn">from</span> <span class="nn">resistics.time.reader</span> <span class="k">import</span> <span class="n">TimeReader</span>
<span class="kn">from</span> <span class="nn">resistics.time.writer_internal</span> <span class="k">import</span> <span class="n">TimeWriterInternal</span>
<span class="kn">from</span> <span class="nn">resistics.common.checks</span> <span class="k">import</span> <span class="n">parseKeywords</span><span class="p">,</span> <span class="n">isElectric</span>
<span class="kn">from</span> <span class="nn">resistics.project.utils</span> <span class="k">import</span> <span class="n">projectText</span><span class="p">,</span> <span class="n">projectBlock</span><span class="p">,</span> <span class="n">checkDateOptions</span>


<div class="viewcode-block" id="getTimeReader"><a class="viewcode-back" href="../../../api/resistics.project.time.html#resistics.project.time.getTimeReader">[docs]</a><span class="k">def</span> <span class="nf">getTimeReader</span><span class="p">(</span><span class="n">projData</span><span class="p">:</span> <span class="n">ProjectData</span><span class="p">,</span> <span class="n">site</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">meas</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TimeReader</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get a data reader object for a measurement</span>

<span class="sd">    Data readers will then return a timeData object when given a sample range of data to return for</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    projData : ProjectData</span>
<span class="sd">        A project data object</span>
<span class="sd">    site : str</span>
<span class="sd">        The site for which to get the data reader</span>
<span class="sd">    meas : str</span>
<span class="sd">        The measurement in the site for which to get the data reader</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DataReader</span>
<span class="sd">        A data reader object which allows a user to get time data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">siteData</span> <span class="o">=</span> <span class="n">projData</span><span class="o">.</span><span class="n">getSiteData</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">siteData</span><span class="o">.</span><span class="n">getMeasurement</span><span class="p">(</span><span class="n">meas</span><span class="p">)</span></div>


<div class="viewcode-block" id="preProcess"><a class="viewcode-back" href="../../../api/resistics.project.time.html#resistics.project.time.preProcess">[docs]</a><span class="k">def</span> <span class="nf">preProcess</span><span class="p">(</span><span class="n">projData</span><span class="p">:</span> <span class="n">ProjectData</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Pre-process project time data</span>

<span class="sd">    Preprocess the time data using filters, notch filters, resampling or interpolation. A new measurement folder is created under the site. The name of the new measurement folder is:</span>
<span class="sd">    prepend_[name of input measurement]_postpend. By default, prepend is &quot;proc&quot; and postpend is empty. </span>

<span class="sd">    Processed time series data can be saved in a new site by using the outputsite option.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    projData : ProjectData</span>
<span class="sd">        A project data object</span>
<span class="sd">    sites : str, List[str], optional</span>
<span class="sd">        Either a single site or a list of sites</span>
<span class="sd">    sampleFreqs : int, float, List[float], optional</span>
<span class="sd">        The frequencies to preprocess</span>
<span class="sd">    start : str, optional</span>
<span class="sd">        Start date of data to preprocess in format &quot;%Y-%m-%d %H:%M:%S&quot;</span>
<span class="sd">    stop : str, optional</span>
<span class="sd">        Stop date of data to process in format &quot;%Y-%m-%d %H:%M:%S&quot;</span>
<span class="sd">    outputsite : str, optional</span>
<span class="sd">        A site to output the preprocessed time data to. If this site does not exist, it will be created</span>
<span class="sd">    polreverse :  Dict[str, bool]</span>
<span class="sd">        Keys are channels and values are boolean flags for reversing </span>
<span class="sd">    scale : Dict[str, float]</span>
<span class="sd">        Keys are channels and values are floats to multiply the channel data by   </span>
<span class="sd">    calibrate : bool, optional</span>
<span class="sd">        Boolean flag for calibrating the data. Default is false and setting to True will calibrate where files can be found.</span>
<span class="sd">    normalise : bool, optional</span>
<span class="sd">        Boolean flag for normalising the data. Default is False and setting to True will normalise each channel independently.</span>
<span class="sd">    filter : Dict, optional</span>
<span class="sd">        Filtering options in a dictionary</span>
<span class="sd">    notch : List[float], optional</span>
<span class="sd">        List of frequencies to notch in spectra given as a list of floats</span>
<span class="sd">    resamp : Dict, optional</span>
<span class="sd">        Resampling parameters in a dictionary with entries in the format: {sampleRateFrom: sampleRateTo}. All measurement directories of sampleRateFrom will be resampled to sampleRateTo</span>
<span class="sd">    interp : bool, optional</span>
<span class="sd">        Boolean flag for interpolating the data on to the second, so that sampling is coincident with seconds. This is not always the case. For example, SPAM data is not necessarily sampled on the second, whereas ATS data is. This function is useful when combining data of multiple formats. Interpolation does not change the sampling rate. Default is False.</span>
<span class="sd">    prepend : str, optional</span>
<span class="sd">        String to prepend to the output folder. Default is &quot;proc&quot;.</span>
<span class="sd">    postpend : str, optional</span>
<span class="sd">        String to postpend to the output folder. Default is empty.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">resistics.project.shortcuts</span> <span class="k">import</span> <span class="n">getCalibrator</span>
    <span class="kn">from</span> <span class="nn">resistics.project.preprocess</span> <span class="k">import</span> <span class="p">(</span>
        <span class="n">applyPolarisationReversalOptions</span><span class="p">,</span>
        <span class="n">applyScaleOptions</span><span class="p">,</span>
        <span class="n">applyCalibrationOptions</span><span class="p">,</span>
        <span class="n">applyFilterOptions</span><span class="p">,</span>
        <span class="n">applyInterpolationOptions</span><span class="p">,</span>
        <span class="n">applyNormaliseOptions</span><span class="p">,</span>
        <span class="n">applyNotchOptions</span><span class="p">,</span>
        <span class="n">applyResampleOptions</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">options</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">]:</span> <span class="n">List</span> <span class="o">=</span> <span class="n">projData</span><span class="o">.</span><span class="n">getSites</span><span class="p">()</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;sampleFreqs&quot;</span><span class="p">]:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">projData</span><span class="o">.</span><span class="n">getSampleFreqs</span><span class="p">()</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">]:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;outputsite&quot;</span><span class="p">]:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;polreverse&quot;</span><span class="p">]:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">]:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;calibrate&quot;</span><span class="p">]:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;normalise&quot;</span><span class="p">]:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;notch&quot;</span><span class="p">]:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;resamp&quot;</span><span class="p">]:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;interp&quot;</span><span class="p">]:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;prepend&quot;</span><span class="p">]:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;proc&quot;</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;postpend&quot;</span><span class="p">]:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">parseKeywords</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># print info</span>
    <span class="n">text</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Processing with options&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
    <span class="n">projectBlock</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">options</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">]]</span>

    <span class="c1"># outputting to another site</span>
    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;outputsite&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">projectText</span><span class="p">(</span>
            <span class="s2">&quot;Preprocessed data will be saved to output site </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">options</span><span class="p">[</span><span class="s2">&quot;outputsite&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># create the site</span>
        <span class="n">projData</span><span class="o">.</span><span class="n">createSite</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;outputsite&quot;</span><span class="p">])</span>
        <span class="n">projData</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="n">outputSitePath</span> <span class="o">=</span> <span class="n">projData</span><span class="o">.</span><span class="n">getSiteData</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;outputsite&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">timePath</span>

    <span class="c1"># output naming</span>
    <span class="n">outPre</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;prepend&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;prepend&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="n">outPost</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;postpend&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;postpend&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">outPre</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">outPost</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;outputsite&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">outPre</span> <span class="o">=</span> <span class="s2">&quot;proc_&quot;</span>

    <span class="c1"># create a data calibrator writer instance</span>
    <span class="n">cal</span> <span class="o">=</span> <span class="n">getCalibrator</span><span class="p">(</span><span class="n">projData</span><span class="o">.</span><span class="n">calPath</span><span class="p">,</span> <span class="n">projData</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;calibrate&quot;</span><span class="p">]:</span>
        <span class="n">cal</span><span class="o">.</span><span class="n">printInfo</span><span class="p">()</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">TimeWriterInternal</span><span class="p">()</span>

    <span class="c1"># format dates</span>
    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]:</span>
        <span class="n">options</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">]:</span>
        <span class="n">options</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">]:</span>
        <span class="n">siteData</span> <span class="o">=</span> <span class="n">projData</span><span class="o">.</span><span class="n">getSiteData</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
        <span class="n">siteData</span><span class="o">.</span><span class="n">printInfo</span><span class="p">()</span>
        <span class="c1"># loop over frequencies</span>
        <span class="k">for</span> <span class="n">sampleFreq</span> <span class="ow">in</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;sampleFreqs&quot;</span><span class="p">]:</span>
            <span class="n">measurements</span> <span class="o">=</span> <span class="n">siteData</span><span class="o">.</span><span class="n">getMeasurements</span><span class="p">(</span><span class="n">sampleFreq</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">measurements</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># no data files at this sample rate</span>
                <span class="k">continue</span>

            <span class="c1"># otherwise, process</span>
            <span class="k">for</span> <span class="n">meas</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">:</span>
                <span class="c1"># get the reader</span>
                <span class="n">projectText</span><span class="p">(</span><span class="s2">&quot;Processing site </span><span class="si">{}</span><span class="s2">, measurement </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">meas</span><span class="p">))</span>
                <span class="n">reader</span> <span class="o">=</span> <span class="n">siteData</span><span class="o">.</span><span class="n">getMeasurement</span><span class="p">(</span><span class="n">meas</span><span class="p">)</span>
                <span class="n">startTime</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
                <span class="n">stopTime</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">getStopDatetime</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">])</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">checkDateOptions</span><span class="p">(</span>
                    <span class="n">options</span><span class="p">,</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">stopTime</span>
                <span class="p">):</span>
                    <span class="k">continue</span>
                <span class="c1"># if the data contributes, copy in the data if relevant</span>
                <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]:</span>
                    <span class="n">startTime</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">]:</span>
                    <span class="n">stopTime</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">]</span>

                <span class="c1"># calculate the samples</span>
                <span class="n">sampleStart</span><span class="p">,</span> <span class="n">sampleEnd</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">time2sample</span><span class="p">(</span><span class="n">startTime</span><span class="p">,</span> <span class="n">stopTime</span><span class="p">)</span>
                <span class="c1"># now get the data</span>
                <span class="n">timeData</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">getPhysicalSamples</span><span class="p">(</span>
                    <span class="n">startSample</span><span class="o">=</span><span class="n">sampleStart</span><span class="p">,</span> <span class="n">endSample</span><span class="o">=</span><span class="n">sampleEnd</span>
                <span class="p">)</span>
                <span class="n">timeData</span><span class="o">.</span><span class="n">printInfo</span><span class="p">()</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">getHeaders</span><span class="p">()</span>
                <span class="n">chanHeaders</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">getChanHeaders</span><span class="p">()</span>

                <span class="c1"># apply options</span>
                <span class="n">applyPolarisationReversalOptions</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">timeData</span><span class="p">)</span>
                <span class="n">applyScaleOptions</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">timeData</span><span class="p">)</span>
                <span class="n">applyCalibrationOptions</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">cal</span><span class="p">,</span> <span class="n">timeData</span><span class="p">,</span> <span class="n">reader</span><span class="p">)</span>
                <span class="n">applyFilterOptions</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">timeData</span><span class="p">)</span>
                <span class="n">applyNotchOptions</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">timeData</span><span class="p">)</span>
                <span class="n">applyInterpolationOptions</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">timeData</span><span class="p">)</span>
                <span class="n">applyResampleOptions</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">timeData</span><span class="p">)</span>
                <span class="n">applyNormaliseOptions</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">timeData</span><span class="p">)</span>

                <span class="c1"># output dataset path</span>
                <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;outputsite&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">timePath</span> <span class="o">=</span> <span class="n">outputSitePath</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">timePath</span> <span class="o">=</span> <span class="n">siteData</span><span class="o">.</span><span class="n">timePath</span>
                <span class="n">outPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timePath</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outPre</span><span class="p">,</span> <span class="n">meas</span><span class="p">,</span> <span class="n">outPost</span><span class="p">))</span>
                <span class="c1"># write time data - need to manually change some headers (hence the keywords)</span>
                <span class="n">writer</span> <span class="o">=</span> <span class="n">TimeWriterInternal</span><span class="p">()</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">setOutPath</span><span class="p">(</span><span class="n">outPath</span><span class="p">)</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writeData</span><span class="p">(</span>
                    <span class="n">headers</span><span class="p">,</span>
                    <span class="n">chanHeaders</span><span class="p">,</span>
                    <span class="n">timeData</span><span class="p">,</span>
                    <span class="n">start_time</span><span class="o">=</span><span class="n">timeData</span><span class="o">.</span><span class="n">startTime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H:%M:%S.</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">),</span>
                    <span class="n">start_date</span><span class="o">=</span><span class="n">timeData</span><span class="o">.</span><span class="n">startTime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
                    <span class="n">stop_time</span><span class="o">=</span><span class="n">timeData</span><span class="o">.</span><span class="n">stopTime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H:%M:%S.</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">),</span>
                    <span class="n">stop_date</span><span class="o">=</span><span class="n">timeData</span><span class="o">.</span><span class="n">stopTime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
                    <span class="n">numSamples</span><span class="o">=</span><span class="n">timeData</span><span class="o">.</span><span class="n">numSamples</span><span class="p">,</span>
                    <span class="n">sample_freq</span><span class="o">=</span><span class="n">timeData</span><span class="o">.</span><span class="n">sampleFreq</span><span class="p">,</span>
                    <span class="n">physical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">printInfo</span><span class="p">()</span></div>


<div class="viewcode-block" id="viewTime"><a class="viewcode-back" href="../../../api/resistics.project.time.html#resistics.project.time.viewTime">[docs]</a><span class="k">def</span> <span class="nf">viewTime</span><span class="p">(</span>
    <span class="n">projData</span><span class="p">:</span> <span class="n">ProjectData</span><span class="p">,</span> <span class="n">startDate</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">endDate</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Figure</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;View timeseries in the project</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    projData : ProjectData</span>
<span class="sd">        The project data instance</span>
<span class="sd">    startDate : str</span>
<span class="sd">        The start of the data range to plot</span>
<span class="sd">    endDate : str</span>
<span class="sd">        The end of the date range to plot</span>
<span class="sd">    sites : List[str], optional</span>
<span class="sd">        List of sites </span>
<span class="sd">    sampleFreqs : List[float], optional</span>
<span class="sd">        List of sample frequencies to plot</span>
<span class="sd">    chans : List[str], optional</span>
<span class="sd">        List of channels to plot</span>
<span class="sd">    polreverse :  Dict[str, bool]</span>
<span class="sd">        Keys are channels and values are boolean flags for reversing   </span>
<span class="sd">    scale : Dict[str, float]</span>
<span class="sd">        Keys are channels and values are floats to multiply the channel data by   </span>
<span class="sd">    calibrate : bool, optional</span>
<span class="sd">        Boolean flag to calibrate data</span>
<span class="sd">    normalise : bool, optional</span>
<span class="sd">        Boolean flag to normalise the data. Default is False and setting to True will normalise each channel independently.</span>
<span class="sd">    notch : List[float], optional</span>
<span class="sd">        List of frequencies to notch out</span>
<span class="sd">    filter : Dict, optional</span>
<span class="sd">        Filter parameters</span>
<span class="sd">    show : bool, optional</span>
<span class="sd">        Boolean flag to show the plot</span>
<span class="sd">    save : bool, optional</span>
<span class="sd">        Boolean flag to save the plot to images folder</span>
<span class="sd">    plotoptions : Dict</span>
<span class="sd">        Dictionary of plot options</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    matplotlib.pyplot.figure or None</span>
<span class="sd">        A matplotlib figure unless the plot is not shown and is saved, in which case None and the figure is closed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">resistics.project.shortcuts</span> <span class="k">import</span> <span class="n">getCalibrator</span>
    <span class="kn">from</span> <span class="nn">resistics.project.preprocess</span> <span class="k">import</span> <span class="p">(</span>
        <span class="n">applyPolarisationReversalOptions</span><span class="p">,</span>
        <span class="n">applyScaleOptions</span><span class="p">,</span>
        <span class="n">applyCalibrationOptions</span><span class="p">,</span>
        <span class="n">applyFilterOptions</span><span class="p">,</span>
        <span class="n">applyNormaliseOptions</span><span class="p">,</span>
        <span class="n">applyNotchOptions</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="kn">from</span> <span class="nn">resistics.common.plot</span> <span class="k">import</span> <span class="n">savePlot</span><span class="p">,</span> <span class="n">plotOptionsTime</span>

    <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">]:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">projData</span><span class="o">.</span><span class="n">sites</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;sampleFreqs&quot;</span><span class="p">]:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">projData</span><span class="o">.</span><span class="n">getSampleFreqs</span><span class="p">()</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;chans&quot;</span><span class="p">]:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Ex&quot;</span><span class="p">,</span> <span class="s2">&quot;Ey&quot;</span><span class="p">,</span> <span class="s2">&quot;Hx&quot;</span><span class="p">,</span> <span class="s2">&quot;Hy&quot;</span><span class="p">,</span> <span class="s2">&quot;Hz&quot;</span><span class="p">]</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;polreverse&quot;</span><span class="p">]:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">]:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;calibrate&quot;</span><span class="p">]:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;normalise&quot;</span><span class="p">]:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;notch&quot;</span><span class="p">]:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;show&quot;</span><span class="p">]:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;save&quot;</span><span class="p">]:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;plotoptions&quot;</span><span class="p">]:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="n">plotOptionsTime</span><span class="p">()</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">parseKeywords</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># prepare calibrator</span>
    <span class="n">cal</span> <span class="o">=</span> <span class="n">getCalibrator</span><span class="p">(</span><span class="n">projData</span><span class="o">.</span><span class="n">calPath</span><span class="p">,</span> <span class="n">projData</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;calibrate&quot;</span><span class="p">]:</span>
        <span class="n">cal</span><span class="o">.</span><span class="n">printInfo</span><span class="p">()</span>

    <span class="c1"># format startDate and endDate</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.000&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">startDate</span><span class="p">),</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S.</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.000&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">endDate</span><span class="p">),</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S.</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># collect relevant data - dictionary to store timeData</span>
    <span class="n">timeDataAll</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">]:</span>
        <span class="n">siteData</span> <span class="o">=</span> <span class="n">projData</span><span class="o">.</span><span class="n">getSiteData</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">siteData</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="c1"># site does not exist</span>
            <span class="k">continue</span>
        <span class="n">siteData</span><span class="o">.</span><span class="n">printInfo</span><span class="p">()</span>
        <span class="n">measurements</span> <span class="o">=</span> <span class="n">siteData</span><span class="o">.</span><span class="n">getMeasurements</span><span class="p">()</span>
        <span class="n">timeDataAll</span><span class="p">[</span><span class="n">site</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># loop over measurements and save data for each one</span>
        <span class="k">for</span> <span class="n">meas</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">:</span>
            <span class="n">sampleFreq</span> <span class="o">=</span> <span class="n">siteData</span><span class="o">.</span><span class="n">getMeasurementSampleFreq</span><span class="p">(</span><span class="n">meas</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sampleFreq</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;sampleFreqs&quot;</span><span class="p">]:</span>
                <span class="k">continue</span>

            <span class="c1"># check if data contributes to user defined time period</span>
            <span class="n">siteStart</span> <span class="o">=</span> <span class="n">siteData</span><span class="o">.</span><span class="n">getMeasurementStart</span><span class="p">(</span><span class="n">meas</span><span class="p">)</span>
            <span class="n">siteStop</span> <span class="o">=</span> <span class="n">siteData</span><span class="o">.</span><span class="n">getMeasurementEnd</span><span class="p">(</span><span class="n">meas</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">siteStop</span> <span class="o">&lt;</span> <span class="n">start</span> <span class="ow">or</span> <span class="n">siteStart</span> <span class="o">&gt;</span> <span class="n">stop</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">reader</span> <span class="o">=</span> <span class="n">siteData</span><span class="o">.</span><span class="n">getMeasurement</span><span class="p">(</span><span class="n">meas</span><span class="p">)</span>
            <span class="c1"># get the samples of the datetimes</span>
            <span class="n">sampleStart</span><span class="p">,</span> <span class="n">sampleStop</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">time2sample</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
            <span class="c1"># as the samples returned from time2sample are rounded use sample2time to get the appropriate start and end times for those samples</span>
            <span class="n">readStart</span><span class="p">,</span> <span class="n">readStop</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">sample2time</span><span class="p">(</span><span class="n">sampleStart</span><span class="p">,</span> <span class="n">sampleStop</span><span class="p">)</span>
            <span class="c1"># get the data for any available channels meaning even those sites with missing channels can be plotted</span>
            <span class="n">timeData</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">getPhysicalData</span><span class="p">(</span><span class="n">readStart</span><span class="p">,</span> <span class="n">readStop</span><span class="p">)</span>

            <span class="n">projectText</span><span class="p">(</span>
                <span class="s2">&quot;Plotting measurement </span><span class="si">{}</span><span class="s2"> of site </span><span class="si">{}</span><span class="s2"> between </span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">meas</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">readStart</span><span class="p">,</span> <span class="n">readStop</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># apply various options</span>
            <span class="n">applyPolarisationReversalOptions</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">timeData</span><span class="p">)</span>
            <span class="n">applyScaleOptions</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">timeData</span><span class="p">)</span>
            <span class="n">applyCalibrationOptions</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">cal</span><span class="p">,</span> <span class="n">timeData</span><span class="p">,</span> <span class="n">reader</span><span class="p">)</span>
            <span class="n">applyFilterOptions</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">timeData</span><span class="p">)</span>
            <span class="n">applyNotchOptions</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">timeData</span><span class="p">)</span>
            <span class="n">applyNormaliseOptions</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">timeData</span><span class="p">)</span>
            <span class="n">timeDataAll</span><span class="p">[</span><span class="n">site</span><span class="p">][</span><span class="n">meas</span><span class="p">]</span> <span class="o">=</span> <span class="n">timeData</span>

    <span class="c1"># plot all the data</span>
    <span class="n">plotfonts</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;plotoptions&quot;</span><span class="p">][</span><span class="s2">&quot;plotfonts&quot;</span><span class="p">]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;plotoptions&quot;</span><span class="p">][</span><span class="s2">&quot;figsize&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">timeDataAll</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">meas</span> <span class="ow">in</span> <span class="n">timeDataAll</span><span class="p">[</span><span class="n">site</span><span class="p">]:</span>
            <span class="n">timeData</span> <span class="o">=</span> <span class="n">timeDataAll</span><span class="p">[</span><span class="n">site</span><span class="p">][</span><span class="n">meas</span><span class="p">]</span>
            <span class="n">timeData</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
                <span class="n">sampleStop</span><span class="o">=</span><span class="n">timeDataAll</span><span class="p">[</span><span class="n">site</span><span class="p">][</span><span class="n">meas</span><span class="p">]</span><span class="o">.</span><span class="n">numSamples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                <span class="n">chans</span><span class="o">=</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;chans&quot;</span><span class="p">],</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">meas</span><span class="p">),</span>
                <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">],</span>
                <span class="n">plotfonts</span><span class="o">=</span><span class="n">plotfonts</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="c1"># add the suptitle</span>
    <span class="n">st</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
        <span class="s2">&quot;Time data from </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">start</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H-%M-%S&quot;</span><span class="p">),</span> <span class="n">stop</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H-%M-%S&quot;</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="n">plotfonts</span><span class="p">[</span><span class="s2">&quot;suptitle&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="mf">0.98</span><span class="p">)</span>

    <span class="c1"># do the axis labels</span>
    <span class="n">numChans</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;chans&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">chan</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;chans&quot;</span><span class="p">]):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">numChans</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># do the yaxis</span>
        <span class="k">if</span> <span class="n">isElectric</span><span class="p">(</span><span class="n">chan</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;mV/km&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">plotfonts</span><span class="p">[</span><span class="s2">&quot;axisLabel&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;plotoptions&quot;</span><span class="p">][</span><span class="s2">&quot;Eylim&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;plotoptions&quot;</span><span class="p">][</span><span class="s2">&quot;Eylim&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;calibrate&quot;</span><span class="p">]:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;nT&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">plotfonts</span><span class="p">[</span><span class="s2">&quot;axisLabel&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;mV&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">plotfonts</span><span class="p">[</span><span class="s2">&quot;axisLabel&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;plotoptions&quot;</span><span class="p">][</span><span class="s2">&quot;Hylim&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;plotoptions&quot;</span><span class="p">][</span><span class="s2">&quot;Hylim&quot;</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">plotfonts</span><span class="p">[</span><span class="s2">&quot;legend&quot;</span><span class="p">])</span>

    <span class="c1"># plot format</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.96</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.92</span><span class="p">)</span>

    <span class="c1"># plot show and save</span>
    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;save&quot;</span><span class="p">]:</span>
        <span class="n">impath</span> <span class="o">=</span> <span class="n">projData</span><span class="o">.</span><span class="n">imagePath</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;timeData_</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">start</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H-%M-%S_&quot;</span><span class="p">),</span> <span class="n">stop</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H-%M-%S&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">savename</span> <span class="o">=</span> <span class="n">savePlot</span><span class="p">(</span><span class="n">impath</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">fig</span><span class="p">)</span>
        <span class="n">projectText</span><span class="p">(</span><span class="s2">&quot;Image saved to file </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">savename</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;show&quot;</span><span class="p">]:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;plotoptions&quot;</span><span class="p">][</span><span class="s2">&quot;block&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;show&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;save&quot;</span><span class="p">]:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">fig</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Neeraj Shah.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/unitedstack/sphinx_rtd_theme">theme</a> provided by <a href="https://github.com/unitedstack">UnitedStack</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.0.6',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/language_data.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>